C - memory allocation,also free memory if unneeded
